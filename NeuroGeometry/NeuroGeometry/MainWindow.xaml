<Window x:Class="NeuroGeometry.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:NeuroGeometry.Views"
        xmlns:vm="clr-namespace:NeuroGeometry.ViewModels"
        Title="NEURO-CORE: SYNAPTIC LINK" Height="720" Width="1080"
        Background="#050505">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="150"/>
        </Grid.RowDefinitions>

        <!-- TOP BAR: SCORE & COMBO -->
        <Border Grid.ColumnSpan="3" Background="#111" BorderBrush="#333" BorderThickness="0,0,0,2" Padding="20">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="SCORE:" Foreground="Gray" FontSize="20" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Score}" Foreground="White" FontSize="28" FontWeight="Bold" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="COMBO" Foreground="Gray" FontSize="14" VerticalAlignment="Bottom" Margin="0,0,5,5"/>
                    <TextBlock Text="{Binding Combo, StringFormat='x{0}'}" Foreground="Yellow" FontSize="40" FontWeight="Black" VerticalAlignment="Center"/>
                </StackPanel>

                <TextBlock Text="{Binding GameMessage}" 
                           Foreground="Cyan" FontSize="18" FontWeight="Bold" 
                           HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="Cyan" BlurRadius="10" ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>
            </Grid>
        </Border>

        <!-- LEFT PANEL: PLAYER STATS -->
        <StackPanel Grid.Row="1" Grid.Column="0" Margin="20">
            <TextBlock Text="{Binding Level, StringFormat='RANK {0}'}" Foreground="White" FontSize="24" FontWeight="Bold" Margin="0,0,0,10"/>

            <TextBlock Text="XP (Focus)" Foreground="Cyan" Margin="0,10,0,0"/>
            <ProgressBar Value="{Binding CurrentXp}" Maximum="{Binding MaxXp}" Height="15" Background="#222" Foreground="Cyan" BorderThickness="0"/>

            <TextBlock Text="OVERDRIVE (Zen)" Foreground="OrangeRed" Margin="0,20,0,0"/>
            <ProgressBar Value="{Binding OverdriveMeter}" Maximum="100" Height="15" Background="#222" Foreground="OrangeRed" BorderThickness="0"/>

            <TextBlock Text="SIGNAL INTEGRITY" Foreground="Gray" Margin="0,40,0,5"/>
            <!-- Impedance Map -->
            <views:AnalysisView DataContext="{Binding}" Height="200"/>
        </StackPanel>

        <!-- CENTER: VISUALIZER (AVATAR) -->
        <Grid Grid.Row="1" Grid.Column="1">
            <Border BorderBrush="#333" BorderThickness="1" Margin="10" Background="#080808" CornerRadius="10">
                <Grid>
                    <!-- Background Grid Lines -->
                    <Path Data="M0,0 L100,100 M100,0 L0,100" Stroke="#111" StrokeThickness="2" Stretch="Fill" Opacity="0.5"/>

                    <!-- The Neuro Geometry -->
                    <Polygon Points="{Binding GeometryPoints}"
                             Stroke="White" StrokeThickness="2"
                             Fill="{Binding GeometryColor}"
                             Opacity="0.8"
                             HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Polygon.Effect>
                            <DropShadowEffect Color="{Binding GeometryColor.Color}" BlurRadius="20" ShadowDepth="0"/>
                        </Polygon.Effect>
                    </Polygon>

                    <Button Content="INITIALIZE LINK" Command="{Binding ConnectCommand}" 
                            HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,20"
                            Background="#333" Foreground="White" Padding="20,10" BorderThickness="0"/>
                </Grid>
            </Border>
        </Grid>

        <!-- RIGHT PANEL: METRICS -->
        <StackPanel Grid.Row="1" Grid.Column="2" Margin="20">
            <TextBlock Text="NEURO-METRICS" Foreground="Gray" FontSize="16" Margin="0,0,0,20"/>

            <Grid Margin="0,0,0,10">
                <ProgressBar Value="{Binding Attention}" Maximum="100" Height="200" Width="40" Orientation="Vertical" HorizontalAlignment="Left" Foreground="Cyan" Background="#222"/>
                <TextBlock Text="ATT" Foreground="Black" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="10,0,0,5" FontWeight="Bold"/>
            </Grid>

            <Grid>
                <ProgressBar Value="{Binding Meditation}" Maximum="100" Height="200" Width="40" Orientation="Vertical" HorizontalAlignment="Right" Foreground="Magenta" Background="#222"/>
                <TextBlock Text="MED" Foreground="Black" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,10,5" FontWeight="Bold"/>
            </Grid>
        </StackPanel>

        <!-- BOTTOM PANEL: RAW WAVE -->
        <Border Grid.Row="2" Grid.ColumnSpan="3" Background="#000" BorderBrush="#333" BorderThickness="0,2,0,0">
            <Grid>
                <TextBlock Text="RAW SYNAPTIC STREAM" Foreground="#333" Margin="10,5,0,0" FontSize="10"/>
                <Polyline Points="{Binding RawWavePoints}" Stroke="Lime" StrokeThickness="1.5" VerticalAlignment="Center" Stretch="Fill">
                    <Polyline.Effect>
                        <BlurEffect Radius="2"/>
                    </Polyline.Effect>
                </Polyline>
            </Grid>
        </Border>
    </Grid>
</Window>